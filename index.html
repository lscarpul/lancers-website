<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lancers Baseball - Home</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#1a365d">
<meta name="apple-mobile-web-app-capable" content="yes">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#1a365d">
<link rel="apple-touch-icon" href="icons/icon-192x192.png"> <meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
</head>
<body>
    <script>
        if (sessionStorage.getItem('authenticated') !== 'true') {
            window.location.href = 'login.html';
        }
    </script>
    <nav class="navbar">
        <div class="nav-brand">
            <span class="logo">âš¾</span>
            <span class="team-name">Lancers Baseball</span>
        </div>
        <ul class="nav-links">
            <li><a href="index.html" class="active">Home</a></li>
            <li><a href="documento.html">Documento</a></li>
            <li><a href="calendario.html">Partite</a></li>
            <li><a href="allenamenti.html">Allenamenti</a></li>
            <li><a href="presenze.html">Presenze</a></li>
        </ul>
        <div class="hamburger">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </nav>

    <main class="hero">
        <div class="hero-content">
            <h1>âš¾ Lancers Baseball Club</h1>
            <p id="welcomeMessage">Benvenuti nella nostra area riservata! Qui trovi tutto ciÃ² che serve per la stagione 2026: documenti, calendari, allenamenti e partite.</p>
            <div class="hero-buttons">
                <a href="area-personale.html" class="btn btn-personal" id="personalAreaBtn" style="display: none;">ğŸ¯ I Miei Obiettivi</a>
                <a href="presenze.html" class="btn btn-presence">ğŸ“‹ Conferma Presenza</a>
                <a href="calendario-completo.html" class="btn btn-primary">ğŸ“… Calendario Completo</a>
                <a href="documento.html" class="btn btn-secondary">ğŸ“„ Documento</a>
            </div>
        </div>
    </main>

    <script>
        // Mostra messaggio personalizzato e pulsante area personale
        const playerData = sessionStorage.getItem('playerData');
        if (playerData) {
            const player = JSON.parse(playerData);
            document.getElementById('welcomeMessage').innerHTML = `Ciao <strong>#${player.number} ${player.name} ${player.surname}</strong>! Benvenuto nella tua area riservata.`;
            document.getElementById('personalAreaBtn').style.display = 'inline-block';
            
            // Mostra pulsante gestione presenze solo per staff autorizzato
            const authorizedNumbers = [25, 19, 38, 6, 'ADMIN'];
            if (authorizedNumbers.includes(player.number)) {
                const staffBtn = document.createElement('a');
                staffBtn.href = 'gestione-presenze.html';
                staffBtn.className = 'btn btn-staff';
                staffBtn.innerHTML = 'ğŸ“Š Gestione Presenze';
                staffBtn.style.background = 'linear-gradient(135deg, #e53e3e 0%, #c53030 100%)';
                staffBtn.style.color = 'white';
                document.querySelector('.hero-buttons').appendChild(staffBtn);
            }
            
            // Popup promemoria presenza per prossimo evento
            checkPresenceReminder(player);
        }
        
        async function checkPresenceReminder(player) {
            // Verifica se c'Ã¨ un evento nelle prossime 72 ore senza risposta
            const allEvents = [
                { date: '2026-01-15', title: 'Allenamento', time: '19:30 - 21:30' },
                { date: '2026-01-20', title: 'Allenamento', time: '19:30 - 21:30' },
                { date: '2026-01-22', title: 'Allenamento', time: '19:30 - 21:30' },
                { date: '2026-01-27', title: 'Allenamento', time: '19:30 - 21:30' },
                { date: '2026-01-29', title: 'Allenamento', time: '19:30 - 21:30' },
                { date: '2026-02-03', title: 'Allenamento', time: '19:30 - 21:30' },
                { date: '2026-02-05', title: 'Allenamento', time: '19:30 - 21:30' },
                { date: '2026-03-01', title: 'Amichevole Interna', time: 'Domenica' },
                { date: '2026-04-12', title: 'vs Health & Performance S.S.D', time: '11:00' }
            ];
            
            const now = new Date();
            const hoursAhead = 72; // Controlla eventi nelle prossime 72 ore
            
            // Carica le risposte da Firebase
            let responses = {};
            try {
                const baseUrl = 'https://lancersareariservata-default-rtdb.europe-west1.firebasedatabase.app';
                const response = await fetch(`${baseUrl}/presenze/${player.number}.json`);
                const data = await response.json();
                if (data) {
                    // Converti le chiavi da underscore a trattini
                    Object.entries(data).forEach(([dateKey, value]) => {
                        const normalizedDate = dateKey.replace(/_/g, '-');
                        responses[normalizedDate] = value;
                    });
                }
            } catch (error) {
                console.error('Errore caricamento presenze:', error);
            }
            
            for (const event of allEvents) {
                const eventDate = new Date(event.date);
                const diffHours = (eventDate - now) / (1000 * 60 * 60);
                
                if (diffHours > 0 && diffHours <= hoursAhead) {
                    // Controlla se ha giÃ  risposto
                    if (!responses[event.date]) {
                        // Non ha ancora risposto, mostra popup
                        showPresencePopup(event, eventDate);
                        break;
                    }
                }
            }
        }
        
        function showPresencePopup(event, eventDate) {
            const days = ['Domenica', 'LunedÃ¬', 'MartedÃ¬', 'MercoledÃ¬', 'GiovedÃ¬', 'VenerdÃ¬', 'Sabato'];
            const months = ['Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio', 'Giugno', 'Luglio', 'Agosto', 'Settembre', 'Ottobre', 'Novembre', 'Dicembre'];
            const dateStr = `${days[eventDate.getDay()]} ${eventDate.getDate()} ${months[eventDate.getMonth()]}`;
            
            const popup = document.createElement('div');
            popup.id = 'presencePopup';
            popup.innerHTML = `
                <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 9999; display: flex; align-items: center; justify-content: center; padding: 1rem;">
                    <div style="background: white; border-radius: 20px; padding: 2rem; max-width: 400px; text-align: center; animation: slideUp 0.3s ease;">
                        <div style="font-size: 4rem; margin-bottom: 1rem;">ğŸ“¢</div>
                        <h2 style="color: #1a365d; margin-bottom: 0.5rem;">Conferma la tua presenza!</h2>
                        <p style="color: #718096; margin-bottom: 1rem;">Hai un evento in arrivo e non hai ancora risposto:</p>
                        <div style="background: #f7fafc; padding: 1rem; border-radius: 12px; margin-bottom: 1.5rem; border-left: 4px solid #ed8936;">
                            <strong style="color: #1a365d;">${event.title}</strong><br>
                            <span style="color: #718096;">ğŸ“… ${dateStr} - ${event.time}</span>
                        </div>
                        <div style="display: flex; gap: 0.5rem; justify-content: center; flex-wrap: wrap;">
                            <a href="presenze.html" style="padding: 0.75rem 1.5rem; background: linear-gradient(135deg, #48bb78, #38a169); color: white; text-decoration: none; border-radius: 10px; font-weight: 600;">âœ… Conferma Ora</a>
                            <button onclick="document.getElementById('presencePopup').remove()" style="padding: 0.75rem 1.5rem; background: #e2e8f0; color: #4a5568; border: none; border-radius: 10px; font-weight: 600; cursor: pointer;">Dopo</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(popup);
        }
    </script>

    <!-- EVENTI SETTIMANA CORRENTE -->
    <section class="weekly-events">
        <div class="weekly-header">
            <h2>ğŸ“… Questa Settimana</h2>
            <p class="week-dates" id="weekDates"></p>
        </div>
        <div class="events-list" id="eventsList">
            <!-- Eventi generati dinamicamente da JavaScript -->
        </div>
        <a href="allenamenti.html" class="view-all-btn">Vedi tutti gli allenamenti â†’</a>
    </section>

    <section class="features">
        <div class="feature-card">
            <div class="feature-icon">ğŸ“…</div>
            <h3>Calendario Completo</h3>
            <p>ğŸ“† Tutto in un'unica vista: allenamenti, amichevoli e partite di campionato.</p>
            <a href="calendario-completo.html" class="feature-link">Vedi tutto â†’</a>
        </div>
        <div class="feature-card">
            <div class="feature-icon">ğŸ“„</div>
            <h3>Documento Tecnico</h3>
            <p>ğŸ“‹ Piano di sviluppo, programmazione allenamenti, obiettivi e regolamento.</p>
            <a href="documento.html" class="feature-link">Vai al documento â†’</a>
        </div>
        <div class="feature-card">
            <div class="feature-icon">âš¾</div>
            <h3>Campionato Serie B</h3>
            <p>ğŸ† Calendario completo delle partite: andata, ritorno e amichevoli pre-stagione.</p>
            <a href="calendario.html" class="feature-link">Vedi partite â†’</a>
        </div>
        <div class="feature-card">
            <div class="feature-icon">ğŸ‹ï¸</div>
            <h3>Allenamenti</h3>
            <p>ğŸ’ª Sessioni di preparazione da Gennaio a Marzo: atletica, tecnica e specifici.</p>
            <a href="allenamenti.html" class="feature-link">Vedi allenamenti â†’</a>
        </div>
    </section>

    <footer>
        <p>âš¾ Â© 2026 Lancers Baseball Club - Serie B Federazione Italiana Baseball Softball</p>
        <p class="footer-motto">"Play Hard, Play Fair, Play Together" ğŸ†</p>
    </footer>

    <script src="script.js"></script>
</body>
</html>
