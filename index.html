    <!-- Tab Bar fissa in basso -->
    <nav class="tab-bar">
    <a href="index.html" class="tab-bar-item active" title="Home">
        <span>ğŸ </span>
        <span>Home</span>
    </a>
    <a href="calendario-completo.html" class="tab-bar-item" title="Calendario">
        <span>ğŸ“…</span>
        <span>Calendario</span>
    </a>
    <a href="calendario.html" class="tab-bar-item" title="Partite">
        <span>âš¾</span>
        <span>Partite</span>
    </a>
    <a href="area-personale.html" class="tab-bar-item" title="Profilo">
        <span>ğŸ‘¤</span>
        <span>Profilo</span>
    </a>
</nav>
<style>
    .tab-bar {
        position: fixed;
        left: 0;
        right: 0;
        bottom: 0;
        height: 64px;
        background: linear-gradient(135deg, #0a1929 0%, #1a365d 100%);
        display: flex;
        justify-content: space-around;
        align-items: center;
        box-shadow: 0 -2px 16px rgba(0,0,0,0.15);
        z-index: 9999;
        width: 100vw;
        max-width: 100vw;
        min-width: 0;
    }
    .tab-bar-item {
        flex: 1;
        text-align: center;
        color: #94a3b8;
        text-decoration: none;
        font-size: 1.1rem;
        font-weight: 600;
        padding: 0.5rem 0;
        transition: color 0.2s;
        display: flex;
        flex-direction: column;
        align-items: center;
    }
    .tab-bar-item span:first-child {
        font-size: 1.5rem;
        margin-bottom: 0.2rem;
    }
    .tab-bar-item span:last-child {
        display: block;
    }
    .tab-bar-item:hover, .tab-bar-item.active {
        color: #f59e0b;
    }
    body { padding-bottom: 70px; }
    html, body {
        height: 100%;
        min-height: 100vh;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }
    @media (max-width: 420px) {
        .tab-bar {
            height: 48px;
            width: 100vw;
        }
        .tab-bar-item span:last-child {
            font-size: 0.7rem;
        }
        .tab-bar-item span:first-child {
            font-size: 1.2rem;
        }
    }
</style>
<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lancers Baseball - Home</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#1a365d">
<meta name="mobile-web-app-capable" content="yes">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#1a365d">
<link rel="apple-touch-icon" href="icons/icon-192x192.png"> <meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
</head>
<body>
    <script>
        // Ripristina sessione da localStorage se disponibile
        if (localStorage.getItem('authenticated') === 'true') {
            sessionStorage.setItem('authenticated', 'true');
            const savedPlayer = localStorage.getItem('playerData');
            if (savedPlayer) sessionStorage.setItem('playerData', savedPlayer);
        }
        if (sessionStorage.getItem('authenticated') !== 'true') {
            window.location.href = 'login.html';
        }
    </script>
    <nav class="navbar">
        <a href="index.html" class="nav-brand" style="text-decoration:none;color:inherit;">
            <div class="baseball-ball logo"></div>
            <span class="team-name">Lancers Baseball</span>
        </a>
        <ul class="nav-links">
            <li><a href="index.html" class="active">ğŸ  Home</a></li>
            <li><a href="calendario-completo.html">ğŸ“… Calendario</a></li>
            <li><a href="allenamenti.html">ğŸ‹ï¸ Allenamenti</a></li>
            <li><a href="calendario.html">âš¾ Partite</a></li>
            <li><a href="presenze.html">ğŸ“‹ Presenze</a></li>
            <li><a href="documento.html">ğŸ“„ Documento</a></li>
            <li><a href="area-personale.html">ğŸ‘¤ Area Personale</a></li>
        </ul>
        <div class="hamburger">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </nav>

    <main class="hero">
        <div class="hero-content">
            <a href="index.html" style="text-decoration: none;"><h1 style="cursor: pointer;">Lancers Baseball Club</h1></a>
            <p id="welcomeMessage">Benvenuti nella nostra area riservata! Qui trovi tutto ciÃ² che serve per la stagione 2026.</p>
            <div class="hero-buttons">
                <a href="gestione-presenze.html" class="btn btn-staff">Area Admin</a>
                <a href="documento.html" class="btn btn-primary">ğŸ“„ Documento</a>
            </div>
        </div>
    </main>

<script>
        // Mostra messaggio personalizzato e pulsante area personale
        const playerData = sessionStorage.getItem('playerData');
        
        document.addEventListener('DOMContentLoaded', async () => {
            if (playerData) {
                const player = JSON.parse(playerData);
                const welcomeMsg = document.getElementById('welcomeMessage');
                if(welcomeMsg) {
                    welcomeMsg.innerHTML = `Ciao <strong>#${player.number} ${player.name} ${player.surname}</strong>! Benvenuto nella tua area riservata.`;
                }
                
                // Mostra pulsante e card area personale
                const personalBtn = document.getElementById('personalAreaBtn');
                if(personalBtn) personalBtn.style.display = 'inline-flex';
                
                const personalCard = document.getElementById('personalCard');
                if(personalCard) personalCard.style.display = 'block';
                
                // Mostra pulsante gestione presenze solo per staff autorizzato
                const authorizedNumbers = [25, 19, 38, 6, 'ADMIN'];
                if (authorizedNumbers.includes(player.number)) {
                    const btnContainer = document.querySelector('.hero-buttons');
                    if (btnContainer && !document.querySelector('.btn-staff')) {
                        const staffBtn = document.createElement('a');
                        staffBtn.href = 'gestione-presenze.html';
                        staffBtn.className = 'btn btn-staff';
                        staffBtn.innerHTML = 'ï¿½ Area Admin';
                        staffBtn.style.background = 'linear-gradient(135deg, #facc15 0%, #eab308 100%)';
                        staffBtn.style.color = 'var(--text-dark)';
                        staffBtn.style.boxShadow = '0 4px 20px rgba(234,179,8,0.35)';
                        btnContainer.appendChild(staffBtn);
                    }
                }
                
                // Popup promemoria presenza per prossimo evento
                await checkPresenceReminder(player);
            }
        });
        
        async function checkPresenceReminder(player) {
            // Verifica se c'Ã¨ un evento nelle prossime 72 ore senza risposta
            // Usa getPlayerEvents per includere i mercoledÃ¬ personalizzati del giocatore
            
            const now = new Date();
            const hoursAhead = 72; // Controlla eventi nelle prossime 72 ore
            
            // Ottieni eventi personalizzati per questo giocatore
            const playerEvents = (typeof getPlayerEvents === 'function') 
                ? getPlayerEvents(player.number) 
                : allEvents;
            
            // Carica le risposte da Firebase (usa LancersDB se disponibile, altrimenti fetch manuale)
            let responses = {};
            try {
                // Proviamo a usare LancersDB se caricato
                if (typeof LancersDB !== 'undefined') {
                    responses = await LancersDB.getPlayer(player.number);
                } else {
                    // Fallback se firebase-config non Ã¨ caricato o ha errore
                    const baseUrl = 'https://lancersareariservata-default-rtdb.europe-west1.firebasedatabase.app';
                    const res = await fetch(`${baseUrl}/presenze/${player.number}.json`);
                    const data = await res.json();
                    if (data) {
                        Object.entries(data).forEach(([dateKey, value]) => {
                            const normalizedDate = dateKey.replace(/_/g, '-');
                            responses[normalizedDate] = value;
                        });
                    }
                }
            } catch (error) {
                console.error('Errore caricamento presenze:', error);
                return;
            }
            
            for (const event of playerEvents) {
                const eventDate = new Date(event.date);
                const diffHours = (eventDate - now) / (1000 * 60 * 60);
                
                // Logica: se l'evento Ã¨ nel futuro (diffHours > -3 per includere durata evento) 
                // ed entro le 72 ore
                if (diffHours > -3 && diffHours <= hoursAhead) {
                    // Controlla se ha giÃ  risposto
                    if (!responses[event.date]) {
                        // Non ha ancora risposto, mostra popup
                        showInteractivePopup(event, eventDate, player);
                        break; // Mostra solo il primo evento imminente
                    }
                }
            }
        }
        
        function showInteractivePopup(event, eventDate, player) {
            // Evita doppi popup
            if(document.getElementById('presencePopup')) return;

            const days = ['Domenica', 'LunedÃ¬', 'MartedÃ¬', 'MercoledÃ¬', 'GiovedÃ¬', 'VenerdÃ¬', 'Sabato'];
            const months = ['Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio', 'Giugno', 'Luglio', 'Agosto', 'Settembre', 'Ottobre', 'Novembre', 'Dicembre'];
            const dateStr = `${days[eventDate.getDay()]} ${eventDate.getDate()} ${months[eventDate.getMonth()]}`;

            const popup = document.createElement('div');
            popup.id = 'presencePopup';
            popup.style.cssText = 'position:fixed;top:0;left:0;right:0;bottom:0;z-index:9999;background:rgba(0,0,0,0.65);display:flex;align-items:flex-end;backdrop-filter:blur(4px)';
            popup.addEventListener('click', (e) => { if (e.target === popup) popup.remove(); });
            popup.innerHTML = `
                <div class="popup-sheet-card" style="background:#1e293b;border-radius:24px 24px 0 0;padding:1.5rem 1.5rem 2.2rem;width:100%;box-shadow:0 -8px 40px rgba(0,0,0,0.5);animation:slideUpSheet 0.32s cubic-bezier(0.34,1.2,0.64,1) both;border-top:1px solid rgba(255,255,255,0.08)">
                    <div style="width:36px;height:4px;background:rgba(255,255,255,0.18);border-radius:4px;margin:0 auto 1.2rem"></div>
                    <p style="color:#94a3b8;font-size:0.78rem;margin-bottom:0.8rem;text-transform:uppercase;letter-spacing:0.06em;font-weight:700">Prossimo evento</p>
                    <div style="background:rgba(59,130,246,0.1);border-left:4px solid #3b82f6;border-radius:0 10px 10px 0;padding:0.9rem 1rem;margin-bottom:1.3rem">
                        <strong style="color:#60a5fa;display:block;font-size:1rem;margin-bottom:0.2rem">${event.title}</strong>
                        <span style="color:#cbd5e1;font-size:0.82rem">ğŸ“… ${dateStr} &nbsp;Â·&nbsp; ğŸ• ${event.time}</span>
                    </div>
                    <div style="background:rgba(34,197,94,0.1);border:1px solid rgba(34,197,94,0.25);border-radius:12px;padding:0.7rem 1rem;display:flex;align-items:center;gap:0.6rem;margin-bottom:1rem">
                        <span style="font-size:1.1rem">âœ…</span>
                        <span style="color:#4ade80;font-weight:700;font-size:0.9rem">Hai risposto: Presente</span>
                    </div>
                    <button onclick="quickSavePresence('${event.date}','no')" style="width:100%;padding:0.85rem;background:rgba(239,68,68,0.1);border:1px solid rgba(239,68,68,0.3);color:#f87171;border-radius:12px;font-weight:700;cursor:pointer;font-size:0.9rem;font-family:inherit;margin-bottom:0.6rem;transition:background 0.2s">âŒ Segna assenza</button>
                    <button onclick="document.getElementById('presencePopup').remove()" style="width:100%;background:none;border:none;color:#64748b;cursor:pointer;text-decoration:underline;font-size:0.8rem;font-family:inherit;padding:0.4rem">Decido dopo</button>
                </div>
            `;
            document.body.appendChild(popup);
        }

        // Funzione per salvare direttamente dal popup
        async function quickSavePresence(date, status) {
            const popupContent = document.querySelector('#presencePopup .popup-sheet-card');
            
            // Feedback visivo di caricamento
            popupContent.innerHTML = `
                <div style="padding: 2rem;">
                    <div style="font-size: 3rem; margin-bottom: 1rem; animation: spin 1s linear infinite;">ğŸ”„</div>
                    <h3>Salvataggio in corso...</h3>
                </div>
            `;

            try {
                const player = JSON.parse(sessionStorage.getItem('playerData'));
                
                // Usa LancersDB se disponibile (grazie all'inclusione di firebase-config.js)
                if (typeof LancersDB !== 'undefined') {
                    await LancersDB.save(player.number, date, status);
                } else {
                    // Fallback manuale
                    console.warn("LancersDB non trovato, uso fetch manuale");
                    const baseUrl = 'https://lancersareariservata-default-rtdb.europe-west1.firebasedatabase.app';
                    const payload = {
                        response: status,
                        timestamp: new Date().toISOString()
                    };
                    await fetch(`${baseUrl}/presenze/${player.number}/${date.replace(/\-/g, '_')}.json`, {
                        method: 'PUT',
                        body: JSON.stringify(payload)
                    });
                }

                // Feedback successo
                popupContent.innerHTML = `
                    <div style="padding: 2rem;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ‰</div>
                        <h3 style="color: #48bb78;">Risposta salvata!</h3>
                        <p>Grazie per aver risposto.</p>
                    </div>
                `;
                
                // Chiudi dopo 1.5 secondi
                setTimeout(() => {
                    document.getElementById('presencePopup').remove();
                }, 1500);

            } catch (error) {
                console.error(error);
                alert("Errore nel salvataggio. Riprova dalla pagina Presenze.");
                document.getElementById('presencePopup').remove();
            }
        }
    </script>
    <!-- EVENTI SETTIMANA CORRENTE -->
    <section class="weekly-events">
        <div class="weekly-header">
            <h2>ğŸ“… Questa Settimana</h2>
            <p class="week-dates" id="weekDates"></p>
        </div>
        <div class="events-list" id="eventsList">
            <!-- Eventi generati dinamicamente da JavaScript -->
        </div>
        <a href="calendario-completo.html" class="view-all-btn">Vedi calendario completo â†’</a>
    </section>

    <section class="features">
        <div class="feature-card">
            <div class="feature-icon">ğŸ“‹</div>
            <h3>Presenze</h3>
            <p>âœ… Conferma la tua presenza agli allenamenti e alle partite.</p>
            <a href="presenze.html" class="feature-link">Conferma presenza â†’</a>
        </div>
        <div class="feature-card">
            <div class="feature-icon">ğŸ“…</div>
            <h3>Calendario Completo</h3>
            <p>ğŸ“† Tutto in un'unica vista: allenamenti, amichevoli e partite.</p>
            <a href="calendario-completo.html" class="feature-link">Vedi calendario â†’</a>
        </div>
        <div class="feature-card">
            <div class="feature-icon">âš¾</div>
            <h3>Partite Serie B</h3>
            <p>ğŸ† Calendario delle partite di campionato.</p>
            <a href="calendario.html" class="feature-link">Vedi partite â†’</a>
        </div>
        <div class="feature-card">
            <div class="feature-icon">ğŸ‹ï¸</div>
            <h3>Allenamenti</h3>
            <p>ğŸ’ª Sessioni di preparazione: atletica, tecnica e specifici.</p>
            <a href="allenamenti.html" class="feature-link">Vedi allenamenti â†’</a>
        </div>
        <div class="feature-card">
            <div class="feature-icon">ğŸ“„</div>
            <h3>Documento</h3>
            <p>ğŸ“‹ Piano di sviluppo, obiettivi e regolamento.</p>
            <a href="documento.html" class="feature-link">Vai al documento â†’</a>
        </div>
        <div class="feature-card" id="personalCard" style="display: none;">
            <div class="feature-icon">ğŸ¯</div>
            <h3>Area Personale</h3>
            <p>ğŸ‘¤ I tuoi obiettivi, statistiche e progressi.</p>
            <a href="area-personale.html" class="feature-link">Vai all'area personale â†’</a>
        </div>
    </section>

    <footer>
        <p>âš¾ Â© 2026 Lancers Baseball Club - Serie B Federazione Italiana Baseball Softball</p>
        <p class="footer-motto">"Play Hard, Play Fair, Play Together" ğŸ†</p>
        <button id="logoutBtn" class="footer-logout-btn">ğŸšª Logout</button>
    </footer>
    <script src="firebase-config.js"></script>
    <script src="script.js?v=55"></script>
</body>
</html>
