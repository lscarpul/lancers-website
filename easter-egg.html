</main>
    <!-- Tab Bar fissa in basso -->
    <nav class="tab-bar">
        <a href="presenze.html" class="tab-bar-item" title="Presenze">
            <span>üìã</span>
            <span>Presenze</span>
        </a>
        <a href="allenamenti.html" class="tab-bar-item" title="Allenamenti">
            <span>üèãÔ∏è</span>
            <span>Allenamenti</span>
        </a>
        <a href="calendario.html" class="tab-bar-item" title="Calendario Partite">
            <span>‚öæ</span>
            <span>Partite</span>
        </a>
        <a href="area-personale.html" class="tab-bar-item" title="Profilo">
            <span>üë§</span>
            <span>Profilo</span>
        </a>
        <!-- Documento rimosso -->
    </nav>
    <style>
        .tab-bar {
            position: fixed;
            left: 0;
            right: 0;
            bottom: 0;
            height: 64px;
            background: linear-gradient(135deg, #0a1929 0%, #1a365d 100%);
            display: flex;
            justify-content: space-around;
            align-items: center;
            box-shadow: 0 -2px 16px rgba(0,0,0,0.15);
            z-index: 9999;
            width: 100vw;
            max-width: 100vw;
            min-width: 0;
        }
        .tab-bar-item {
            flex: 1;
            text-align: center;
            color: #94a3b8;
            text-decoration: none;
            font-size: 1.1rem;
            font-weight: 600;
            padding: 0.5rem 0;
            transition: color 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .tab-bar-item span:first-child {
            font-size: 1.5rem;
            margin-bottom: 0.2rem;
        }
        .tab-bar-item span:last-child {
            display: block;
        }
        .tab-bar-item:hover, .tab-bar-item.active {
            color: #f59e0b;
        }
        body { padding-bottom: 70px; }
        html, body {
            height: 100%;
            min-height: 100vh;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        @media (max-width: 420px) {
            .tab-bar {
                height: 48px;
                width: 100vw;
            }
            .tab-bar-item span:last-child {
                font-size: 0.7rem;
            }
            .tab-bar-item span:first-child {
                font-size: 1.2rem;
            }
        }
    </style>
<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>üéÆ Home Run Derby - Lancers Baseball</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;900&display=swap" rel="stylesheet">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0a1929">
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            min-height: 100vh;
            background: linear-gradient(135deg, #0a1929 0%, #0f2847 50%, #1a365d 100%);
            color: white;
            overflow-x: hidden;
            user-select: none;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }

        /* Header */
        .game-header {
            text-align: center;
            padding: 1rem 0;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .game-header h1 {
            font-size: 2rem;
            font-weight: 900;
            background: linear-gradient(90deg, #ffd700, #ff8c00, #ffd700);
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: shine 3s linear infinite;
            margin-bottom: 0.25rem;
        }

        .game-header p {
            color: #94a3b8;
            font-size: 0.9rem;
        }

        @keyframes shine {
            to { background-position: 200% center; }
        }

        /* Main Layout */
        .game-layout {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin-top: 1rem;
        }

        @media (max-width: 900px) {
            .game-layout {
                flex-direction: column;
                align-items: center;
            }
        }

        /* Game Container */
        .game-container {
            background: linear-gradient(135deg, rgba(15, 40, 71, 0.8) 0%, rgba(26, 54, 93, 0.6) 100%);
            border-radius: 20px;
            padding: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        /* Scoreboard */
        .scoreboard {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .score-box {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 12px;
            padding: 0.75rem;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .score-box.homerun {
            border-color: rgba(255, 215, 0, 0.3);
            background: rgba(255, 215, 0, 0.1);
        }

        .score-label {
            font-size: 0.7rem;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .score-value {
            font-size: 1.8rem;
            font-weight: 900;
            color: #ffd700;
        }

        .score-box.homerun .score-value {
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        /* Count Display */
        .count-display {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 1rem;
        }

        .count-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .count-label {
            font-weight: 700;
            font-size: 1rem;
            width: 20px;
        }

        .count-dots {
            display: flex;
            gap: 0.3rem;
        }

        .dot {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.15);
            border: 2px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .dot.ball.active {
            background: #22c55e;
            border-color: #22c55e;
            box-shadow: 0 0 15px rgba(34, 197, 94, 0.6);
        }

        .dot.strike.active {
            background: #ef4444;
            border-color: #ef4444;
            box-shadow: 0 0 15px rgba(239, 68, 68, 0.6);
        }

        /* Game Area */
        .game-area {
            position: relative;
            width: 100%;
            height: 450px;
            border-radius: 16px;
            overflow: hidden;
            cursor: pointer;
            touch-action: manipulation;
            background: 
                linear-gradient(to bottom, 
                    #1e3a5f 0%, 
                    #2d4a6f 20%,
                    #3d5a80 40%,
                    #4a7c59 60%,
                    #3d6b4f 80%,
                    #2d5a3f 100%);
        }

        /* Stadium Background */
        .stadium-bg {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .outfield-wall {
            position: absolute;
            top: 35%;
            left: 5%;
            right: 5%;
            height: 8px;
            background: linear-gradient(90deg, #1a4731, #22543d, #1a4731);
            border-radius: 4px;
            box-shadow: 0 4px 0 #15392a;
        }

        .warning-track {
            position: absolute;
            top: 36%;
            left: 5%;
            right: 5%;
            height: 20px;
            background: #8b6914;
            border-radius: 0 0 50% 50% / 0 0 100% 100%;
        }

        /* Diamond */
        .diamond {
            position: absolute;
            bottom: 15%;
            left: 50%;
            transform: translateX(-50%);
            width: 180px;
            height: 180px;
        }

        .infield-dirt {
            position: absolute;
            width: 100%;
            height: 100%;
            background: #c9a857;
            transform: rotate(45deg);
            border-radius: 10px;
            opacity: 0.7;
        }

        .base {
            position: absolute;
            width: 16px;
            height: 16px;
            background: white;
            transform: rotate(45deg);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .home { bottom: -8px; left: 50%; margin-left: -8px; }
        .first { right: -8px; top: 50%; margin-top: -8px; }
        .second { top: -8px; left: 50%; margin-left: -8px; }
        .third { left: -8px; top: 50%; margin-top: -8px; }

        /* Mound */
        .mound {
            position: absolute;
            top: 40%;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 15px;
            background: #c9a857;
            border-radius: 50%;
        }

        /* Strike Zone */
        .strike-zone {
            position: absolute;
            bottom: 18%;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 100px;
            border: 3px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            pointer-events: none;
            transition: border-color 0.2s;
        }

        .strike-zone.active {
            border-color: rgba(34, 197, 94, 0.6);
            box-shadow: inset 0 0 20px rgba(34, 197, 94, 0.2);
        }

        /* Pitcher */
        .pitcher {
            position: absolute;
            top: 38%;
            left: 50%;
            transform: translateX(-50%);
            font-size: 2.5rem;
            z-index: 5;
            transition: transform 0.15s;
            filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.3));
        }

        .pitcher.throwing {
            animation: throwPitch 0.4s ease;
        }

        @keyframes throwPitch {
            0% { transform: translateX(-50%) scale(1); }
            30% { transform: translateX(-50%) scale(1.2) rotate(-15deg); }
            60% { transform: translateX(-50%) scale(0.9) rotate(5deg); }
            100% { transform: translateX(-50%) scale(1) rotate(0deg); }
        }

        /* Batter */
        .batter-box {
            position: absolute;
            bottom: 12%;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
        }

        .batter {
            font-size: 3rem;
            filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.3));
            transition: transform 0.1s;
        }

        .batter.swing {
            animation: swingBat 0.25s ease;
        }

        @keyframes swingBat {
            0% { transform: rotate(0deg); }
            40% { transform: rotate(-30deg) scale(1.1); }
            100% { transform: rotate(0deg); }
        }

        /* Ball */
        .ball {
            position: absolute;
            font-size: 1.8rem;
            z-index: 15;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.4));
            transition: transform 0.05s linear;
            pointer-events: none;
        }

        .ball.hit {
            animation: ballHit 0.8s ease-out forwards;
        }

        @keyframes ballHit {
            0% { transform: scale(1); }
            50% { transform: scale(0.5) translateY(-200px); }
            100% { transform: scale(0.1) translateY(-400px); opacity: 0; }
        }

        /* Game Message */
        .game-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2.5rem;
            font-weight: 900;
            text-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            opacity: 0;
            pointer-events: none;
            z-index: 50;
            white-space: nowrap;
        }

        .game-message.show {
            animation: messagePopup 1.2s ease forwards;
        }

        @keyframes messagePopup {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.3); }
            20% { opacity: 1; transform: translate(-50%, -50%) scale(1.3); }
            40% { transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -60%) scale(0.8); }
        }

        .message-homerun { color: #ffd700; text-shadow: 0 0 30px #ffd700, 0 0 60px #ff8c00; }
        .message-hit { color: #22c55e; }
        .message-strike { color: #ef4444; }
        .message-ball { color: #3b82f6; }
        .message-out { color: #ef4444; font-size: 3rem; }
        .message-walk { color: #22c55e; }

        /* Overlays */
        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            border-radius: 16px;
            backdrop-filter: blur(10px);
        }

        .overlay.hidden {
            display: none;
        }

        .overlay h2 {
            font-size: 2.5rem;
            font-weight: 900;
            color: #ffd700;
            margin-bottom: 1rem;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        .overlay p {
            color: #94a3b8;
            margin-bottom: 0.5rem;
            text-align: center;
            max-width: 300px;
        }

        .overlay .instructions {
            background: rgba(255, 255, 255, 0.1);
            padding: 1rem;
            border-radius: 12px;
            margin: 1rem 0;
            font-size: 0.9rem;
        }

        .overlay .instructions strong {
            color: #ffd700;
        }

        .play-btn {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: white;
            border: none;
            padding: 1rem 3rem;
            font-size: 1.3rem;
            font-weight: 700;
            border-radius: 50px;
            cursor: pointer;
            font-family: 'Montserrat', sans-serif;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(34, 197, 94, 0.4);
            margin-top: 1rem;
        }

        .play-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 30px rgba(34, 197, 94, 0.6);
        }

        .play-btn:active {
            transform: scale(0.98);
        }

        /* Game Over specific */
        .game-over-score {
            font-size: 4rem;
            font-weight: 900;
            color: #ffd700;
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
            margin: 1rem 0;
        }

        .game-over-score span {
            font-size: 1.5rem;
            color: #94a3b8;
        }

        /* Instructions */
        .game-instructions {
            margin-top: 1rem;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            font-size: 0.85rem;
            color: #94a3b8;
        }

        .game-instructions h4 {
            color: #ffd700;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        /* Back Button */
        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 1.5rem;
            padding: 0.75rem 1.5rem;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            text-decoration: none;
            border-radius: 10px;
            font-weight: 600;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        /* Fireworks for home run */
        .firework {
            position: absolute;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            pointer-events: none;
            z-index: 30;
        }

        /* Speed indicator */
        .speed-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.5);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            color: #94a3b8;
        }

        .speed-indicator span {
            color: #ef4444;
            font-weight: 700;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 0.5rem;
            }

            .game-header h1 {
                font-size: 1.5rem;
            }

            .game-area {
                height: 400px;
            }

            .scoreboard {
                grid-template-columns: repeat(2, 1fr);
            }

            .score-value {
                font-size: 1.4rem;
            }

            .leaderboard-panel {
                margin-top: 1rem;
            }

            .overlay h2 {
                font-size: 1.8rem;
            }

            .game-message {
                font-size: 2rem;
            }
        }

        /* Credits footer */
        .credits-footer {
            text-align: center;
            margin-top: 1.5rem;
            color: #64748b;
            font-size: 0.8rem;
        }

        .credits-footer strong {
            color: #94a3b8;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="game-header">
            <h1>‚öæ HOME RUN DERBY ‚öæ</h1>
            <p>Colpisci la palla nel momento giusto!</p>
        </div>

        <div class="game-layout">
            <!-- Game Section -->
            <div class="game-container">
                <div class="scoreboard">
                    <div class="score-box homerun">
                        <div class="score-label">Home Run</div>
                        <div class="score-value" id="homeRuns">0</div>
                    </div>
                    <div class="score-box">
                        <div class="score-label">Colpite</div>
                        <div class="score-value" id="hits">0</div>
                    </div>
                    <div class="score-box">
                        <div class="score-label">Outs</div>
                        <div class="score-value" id="outs">0</div>
                    </div>
                    <div class="score-box">
                        <div class="score-label">Velocit√†</div>
                        <div class="score-value" id="speed">80</div>
                    </div>
                </div>

                <div class="count-display">
                    <div class="count-group">
                        <span class="count-label" style="color: #3b82f6;">B</span>
                        <div class="count-dots">
                            <div class="dot ball" id="b1"></div>
                            <div class="dot ball" id="b2"></div>
                            <div class="dot ball" id="b3"></div>
                        </div>
                    </div>
                    <div class="count-group">
                        <span class="count-label" style="color: #ef4444;">S</span>
                        <div class="count-dots">
                            <div class="dot strike" id="s1"></div>
                            <div class="dot strike" id="s2"></div>
                        </div>
                    </div>
                </div>

                <div class="game-area" id="gameArea">
                    <!-- Stadium Background -->
                    <div class="stadium-bg">
                        <div class="outfield-wall"></div>
                        <div class="warning-track"></div>
                    </div>

                    <!-- Diamond -->
                    <div class="diamond">
                        <div class="infield-dirt"></div>
                        <div class="base home"></div>
                        <div class="base first"></div>
                        <div class="base second"></div>
                        <div class="base third"></div>
                    </div>

                    <!-- Mound -->
                    <div class="mound"></div>

                    <!-- Strike Zone -->
                    <div class="strike-zone" id="strikeZone"></div>

                    <!-- Pitcher -->
                    <div class="pitcher" id="pitcher">‚öæü§æ</div>

                    <!-- Batter -->
                    <div class="batter-box">
                        <div class="batter" id="batter">üèèüßç</div>
                    </div>

                    <!-- Ball -->
                    <div class="ball" id="ball" style="display: none;">‚öæ</div>

                    <!-- Message -->
                    <div class="game-message" id="gameMessage"></div>

                    <!-- Speed Indicator -->
                    <div class="speed-indicator">
                        Pitch: <span id="pitchSpeed">80</span> mph
                    </div>

                    <!-- Start Overlay -->
                    <div class="overlay" id="startOverlay">
                        <h2>‚öæ HOME RUN DERBY</h2>
                        <div class="instructions">
                            <p><strong>üéØ OBIETTIVO:</strong> Fai pi√π Home Run possibili!</p>
                            <p><strong>üëÜ TOCCA/CLICCA</strong> quando la palla √® nella zona</p>
                            <p><strong>‚ö° TIMING PERFETTO</strong> = Home Run!</p>
                            <p><strong>‚ùå 3 Strike</strong> = 1 Out | <strong>3 Outs</strong> = Game Over</p>
                            <p><strong>üü¢ 4 Ball</strong> = Walk (+1 HR bonus!)</p>
                        </div>
                        <button class="play-btn" id="startBtn">‚ñ∂Ô∏è GIOCA!</button>
                    </div>

                    <!-- Game Over Overlay -->
                    <div class="overlay hidden" id="gameOverOverlay">
                        <h2>‚öæ GAME OVER</h2>
                        <div class="game-over-score">
                            <span id="finalScore">0</span>
                            <span>Home Run</span>
                        </div>
                        <p id="rankMessage">Caricamento classifica...</p>
                        <button class="play-btn" id="retryBtn">üîÑ RIPROVA</button>
                    </div>
                </div>

                <div class="game-instructions">
                    <h4>üéÆ Controlli</h4>
                    <p>Tocca o clicca sullo schermo per colpire. Pi√π sei preciso, meglio colpisci!</p>
                </div>
            </div>
        </div>

        <a href="index.html" class="back-btn">‚Üê Torna al sito</a>

        <div class="credits-footer">
            <p>üéÆ Easter Egg by <strong>Lorenzo Scarpulla</strong> | Lancers Baseball Club</p>
        </div>
    </div>

    <script>

        // Get player info
        function getPlayerInfo() {
            const playerData = localStorage.getItem('playerData') || sessionStorage.getItem('playerData');
            if (playerData) {
                try {
                    const player = JSON.parse(playerData);
                    return {
                        name: player.name + ' ' + player.surname,
                        number: player.number
                    };
                } catch (e) {
                    return { name: 'Anonimo', number: 0 };
                }
            }
            return { name: 'Anonimo', number: 0 };
        }

        // Game State
        const game = {
            homeRuns: 0,
            hits: 0,
            outs: 0,
            balls: 0,
            strikes: 0,
            speed: 80,
            isPlaying: false,
            ballActive: false,
            canSwing: false,
            ballX: 0,
            ballY: 0,
            pitchInZone: false
        };

        // DOM Elements
        const gameArea = document.getElementById('gameArea');
        const ball = document.getElementById('ball');
        const batter = document.getElementById('batter');
        const pitcher = document.getElementById('pitcher');
        const strikeZone = document.getElementById('strikeZone');
        const gameMessage = document.getElementById('gameMessage');
        const startOverlay = document.getElementById('startOverlay');
        const gameOverOverlay = document.getElementById('gameOverOverlay');
        const startBtn = document.getElementById('startBtn');
        const retryBtn = document.getElementById('retryBtn');

        // Update Display
        function updateDisplay() {
            document.getElementById('homeRuns').textContent = game.homeRuns;
            document.getElementById('hits').textContent = game.hits;
            document.getElementById('outs').textContent = game.outs;
            document.getElementById('speed').textContent = game.speed;
            document.getElementById('pitchSpeed').textContent = game.speed;

            // Update count dots
            for (let i = 1; i <= 3; i++) {
                document.getElementById('b' + i).classList.toggle('active', game.balls >= i);
            }
            for (let i = 1; i <= 2; i++) {
                document.getElementById('s' + i).classList.toggle('active', game.strikes >= i);
            }
        }

        // Show Message
        function showMessage(text, type) {
            gameMessage.textContent = text;
            gameMessage.className = 'game-message show message-' + type;
            setTimeout(() => {
                gameMessage.className = 'game-message';
            }, 1200);
        }

        // Create Fireworks
        function createFireworks() {
            const colors = ['#ffd700', '#ff6b6b', '#4ade80', '#60a5fa', '#f472b6'];
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    const firework = document.createElement('div');
                    firework.className = 'firework';
                    firework.style.left = (20 + Math.random() * 60) + '%';
                    firework.style.top = (20 + Math.random() * 30) + '%';
                    firework.style.background = colors[Math.floor(Math.random() * colors.length)];
                    firework.style.boxShadow = `0 0 10px ${firework.style.background}`;
                    firework.style.animation = 'fireworkPop 0.8s ease forwards';
                    gameArea.appendChild(firework);
                    setTimeout(() => firework.remove(), 800);
                }, i * 50);
            }
        }

        // Add firework animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fireworkPop {
                0% { transform: scale(0); opacity: 1; }
                50% { transform: scale(2); opacity: 1; }
                100% { transform: scale(3); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // Pitch
        function pitch() {
            if (!game.isPlaying || game.ballActive) return;

            game.ballActive = true;
            game.canSwing = false;

            // Pitcher animation
            pitcher.classList.add('throwing');
            setTimeout(() => pitcher.classList.remove('throwing'), 400);

            const gameRect = gameArea.getBoundingClientRect();
            const startX = gameRect.width / 2;
            const startY = gameRect.height * 0.38;

            // Random pitch location - some in zone, some outside
            const isInZone = Math.random() > 0.35; // 65% in zone
            game.pitchInZone = isInZone;

            let targetX, targetY;
            if (isInZone) {
                // In strike zone
                targetX = startX + (Math.random() - 0.5) * 40;
                targetY = gameRect.height * 0.75;
            } else {
                // Ball - outside zone
                const side = Math.random() > 0.5 ? 1 : -1;
                targetX = startX + side * (60 + Math.random() * 40);
                targetY = gameRect.height * (0.65 + Math.random() * 0.2);
            }

            game.ballX = startX;
            game.ballY = startY;

            ball.style.display = 'block';
            ball.style.left = game.ballX + 'px';
            ball.style.top = game.ballY + 'px';
            ball.classList.remove('hit');

            // Animation duration based on speed
            const duration = 1200 - (game.speed * 5); // faster with higher speed
            const startTime = Date.now();

            function animateBall() {
                if (!game.ballActive) return;

                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / duration, 1);

                // Smooth curve
                const easeProgress = progress < 0.5 
                    ? 2 * progress * progress 
                    : 1 - Math.pow(-2 * progress + 2, 2) / 2;

                game.ballX = startX + (targetX - startX) * easeProgress;
                game.ballY = startY + (targetY - startY) * easeProgress;

                // Scale ball as it gets closer
                const scale = 0.6 + (progress * 0.6);
                ball.style.transform = `scale(${scale})`;
                ball.style.left = game.ballX + 'px';
                ball.style.top = game.ballY + 'px';

                // Enable swing in the hitting window
                if (progress > 0.6 && progress < 0.95) {
                    game.canSwing = true;
                    strikeZone.classList.add('active');
                } else {
                    strikeZone.classList.remove('active');
                }

                if (progress < 1 && game.ballActive) {
                    requestAnimationFrame(animateBall);
                } else if (game.ballActive) {
                    // Ball passed - check if strike or ball
                    game.canSwing = false;
                    strikeZone.classList.remove('active');
                    
                    if (game.pitchInZone) {
                        handleStrike();
                    } else {
                        handleBall();
                    }
                }
            }

            requestAnimationFrame(animateBall);
        }

        // Swing
        function swing(e) {
            if (!game.isPlaying || !game.ballActive) return;
            if (e.target.closest('.overlay') || e.target.closest('button')) return;

            // Swing animation
            batter.classList.add('swing');
            setTimeout(() => batter.classList.remove('swing'), 250);

            if (!game.canSwing) {
                // Swung too early or too late
                return;
            }

            // Calculate hit quality
            const gameRect = gameArea.getBoundingClientRect();
            const zoneRect = strikeZone.getBoundingClientRect();

            const zoneCenterX = zoneRect.left + zoneRect.width / 2 - gameRect.left;
            const zoneCenterY = zoneRect.top + zoneRect.height / 2 - gameRect.top;

            const distanceX = Math.abs(game.ballX - zoneCenterX);
            const distanceY = Math.abs(game.ballY - zoneCenterY);
            const distance = Math.sqrt(distanceX * distanceX + distanceY * distanceY);

            game.ballActive = false;
            ball.classList.add('hit');

            if (distance < 25) {
                // Perfect hit - HOME RUN!
                handleHomeRun();
            } else if (distance < 50 && game.pitchInZone) {
                // Good hit
                handleHit();
            } else {
                // Miss or foul
                handleStrike();
            }
        }

        // Handle Home Run
        function handleHomeRun() {
            game.homeRuns++;
            game.balls = 0;
            game.strikes = 0;
            game.speed = Math.min(120, game.speed + 2);
            updateDisplay();
            showMessage('üéâ HOME RUN! üéâ', 'homerun');
            createFireworks();

            setTimeout(() => {
                ball.style.display = 'none';
                if (game.isPlaying) pitch();
            }, 1500);
        }

        // Handle Hit
        function handleHit() {
            game.hits++;
            game.balls = 0;
            game.strikes = 0;
            updateDisplay();
            showMessage('COLPITA! ‚öæ', 'hit');

            setTimeout(() => {
                ball.style.display = 'none';
                if (game.isPlaying) pitch();
            }, 1200);
        }

        // Handle Strike
        function handleStrike() {
            game.ballActive = false;
            game.strikes++;
            updateDisplay();

            if (game.strikes >= 3) {
                game.outs++;
                game.strikes = 0;
                game.balls = 0;
                updateDisplay();

                if (game.outs >= 3) {
                    gameOver();
                    showMessage('üíÄ GAME OVER üíÄ', 'out');
                } else {
                    showMessage('‚öæ STRIKE OUT!', 'out');
                    setTimeout(() => {
                        ball.style.display = 'none';
                        if (game.isPlaying) pitch();
                    }, 1500);
                }
            } else {
                showMessage('‚ùå STRIKE!', 'strike');
                setTimeout(() => {
                    ball.style.display = 'none';
                    if (game.isPlaying) pitch();
                }, 1000);
            }
        }

        // Handle Ball
        function handleBall() {
            game.ballActive = false;
            game.balls++;
            updateDisplay();

            if (game.balls >= 4) {
                // Walk - bonus HR
                game.homeRuns++;
                game.balls = 0;
                game.strikes = 0;
                updateDisplay();
                showMessage('üö∂ WALK! +1 HR', 'walk');

                setTimeout(() => {
                    ball.style.display = 'none';
                    if (game.isPlaying) pitch();
                }, 1500);
            } else {
                showMessage('üü¢ BALL', 'ball');
                setTimeout(() => {
                    ball.style.display = 'none';
                    if (game.isPlaying) pitch();
                }, 800);
            }
        }

        // Game Over
        function gameOver() {
            game.isPlaying = false;
            ball.style.display = 'none';

            document.getElementById('finalScore').textContent = game.homeRuns;

            // Show simple message
            const rankMsg = document.getElementById('rankMessage');
            if (game.homeRuns >= 10) {
                rankMsg.textContent = `üèÜ Incredibile! ${game.homeRuns} Home Run!`;
            } else if (game.homeRuns >= 5) {
                rankMsg.textContent = `üéâ Ottimo lavoro! ${game.homeRuns} Home Run!`;
            } else if (game.homeRuns >= 1) {
                rankMsg.textContent = `üëç Bene! Prova a battere il tuo record!`;
            } else {
                rankMsg.textContent = `üòÖ Nessun Home Run... Riprova!`;
            }

            gameOverOverlay.classList.remove('hidden');
        }

        // Reset Game
        function resetGame() {
            game.homeRuns = 0;
            game.hits = 0;
            game.outs = 0;
            game.balls = 0;
            game.strikes = 0;
            game.speed = 80;
            game.isPlaying = false;
            game.ballActive = false;
            game.canSwing = false;
            updateDisplay();
        }

        // Start Game
        function startGame() {
            resetGame();
            game.isPlaying = true;
            startOverlay.classList.add('hidden');
            gameOverOverlay.classList.add('hidden');
            setTimeout(pitch, 500);
        }

        // Event Listeners
        gameArea.addEventListener('click', swing);
        gameArea.addEventListener('touchstart', (e) => {
            if (e.target.closest('.overlay') || e.target.closest('button')) return;
            e.preventDefault();
            swing(e);
        }, { passive: false });

        startBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            startGame();
        });

        retryBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            startGame();
        });
    </script>
</body>
</html>
